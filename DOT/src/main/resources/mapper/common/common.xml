<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="common">
	
	<resultMap id="imageResultSet" type="images">
		<id column="FILE_NO" property="fileNo"/>
		<result column="FILE_WRITER" property="fileWriter"/>
		<result column="ORIGIN_NAME" property="originName"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="FILE_PATH" property="filePath"/>
		<result column="STATUS" property="status"/>
		<result column="FILE_LEVEL" property="fileLevel"/>
		<result column="FILE_FNO" property="fileFno"/>
	</resultMap>
	
	<resultMap id="searchResultSet" type="search">
		<id column="SEARCH_NO" property="searchNo"/>
		<result column="SEARCH_WRITER" property="searchWriter"/>
		<result column="SEARCH_KEYWORD" property="searchKeyword"/>
		<result column="ENROLL_DATE" property="enrollDate"/>
	</resultMap>
	
	<resultMap id="memberResultSet" type="member">
		<id column="USER_NO" property="userNo"/>
		<result column="USER_ID" property='userId'/>
		<result column="USER_PWD" property="userPwd"/>
		<result column="USER_NAME" property="userName"/>
		<result column="USER_NICK" property="userNick"/>
		<result column="USER_PHONE" property="userPhone"/>
		<result column="USER_EMAIL" property="userEmail"/>
		<result column="USER_MBTI" property="userMbti"/>
		<result column="ENROLL_DATE" property="enrollDate"/>
		<result column="USER_BIRTHDAY" property="userBirthday"/>
		<result column="ENABLE" property="enable"/>
		<result column='WB_STATUS' property="wbStatus"/>
		<result column="STATUS" property="status"/>
		<result column="CHECK_LOGIN" property="checkLog"/>
	</resultMap>
	
	<select id="selectList" parameterType="string" resultMap="imageResultSet">
		SELECT *
		FROM IMAGE I
		JOIN FEED F ON F.FEED_NO = I.FILE_FNO
		WHERE F.FEED_HASHTAG LIKE '%${keyword}%' AND I.FILE_LEVEL = '2'
	</select> 
	
	
	<select id="MyHistory" parameterType="int" resultMap="searchResultSet">
		SELECT *
		FROM SEARCH
		WHERE SEARCH_WRITER = #{i}
		ORDER BY SEARCH_NO DESC
	</select>
	
	<insert id="insertSearch" parameterType="search">
		INSERT INTO SEARCH
		VALUES (
				SEQ_SEARCH_NO.NEXTVAL,
				#{searchWriter},
				#{searchKeyword},
				SYSDATE				
				)
	</insert>
	
	<!-- 관리자페이지 회원 관리 -->
   <select id="memList1" resultMap="memberResultSet">   
      SELECT *
      FROM MEMBER
      
   </select>
   
   
   <select id="memList" resultMap="memberResultSet">   
      SELECT *
      FROM MEMBER
      <if test="keyword != null and keyword != ''">
         WHERE
         <choose>
            <when test="condition == 'userId'">
               USER_ID LIKE '%${keyword}%'
            </when>
            <when test="condition == 'userName'">
               USER_NAME LIKE '%${keyword}%'
            </when>
            <when test="condition == 'userNick'">
               USER_NICK LIKE '%${keyword}%'
            </when>
         </choose>
      </if>
   </select>
   
   <select id="selectMListCount" parameterType="hashmap" resultType="int">
      SELECT
         COUNT(*)
      FROM MEMBER
      <if test="keyword != null and keyword != ''">
         WHERE
         <choose>
            <when test="condition == 'userId'">
               USER_ID LIKE '%${keyword}%'
            </when>
            <when test="condition == 'userName'">
               USER_NAME LIKE '%${keyword}%'
            </when>
            <when test="condition == 'userNick'">
               USER_NICK LIKE '%${keyword}%'
            </when>
         </choose>
      </if>
   </select>
	
</mapper>
